from django.shortcuts import render,redirect
from pymetasploit3.msfrpc import MsfRpcClient
# Create your views here.

def enter_pass(request):
    if request.method == 'POST':
        request.session['pass'] = request.POST['password']
        return redirect('select_exploit')

    return render(request,'enter_pass.html')

def select_exploit(request):
    client = MsfRpcClient(request.session['pass'], port=55552)
    if request.method == 'POST':

        request.session['exploit'] = request.POST['exploit']
        return redirect('options')
    return render(request,'select_exploit.html',{'exploit':client.modules.exploits})

def option(request):
    # print(request.session['exploit'])
    client = MsfRpcClient(request.session['pass'], port=55552)
    exploit = client.modules.use('exploit',request.session['exploit'])
    return render(request,'options.html',{'missing':exploit.missing_required,'desc':exploit.description,'target_paylaods':exploit.targetpayloads()})

def execute_exploit(request):
    if request.method == 'POST':
        client = MsfRpcClient(request.session['pass'], port=55552)
        exploit = client.modules.use('exploit',request.session['exploit'])
        for i in exploit.missing_required:
            exploit[i] = request.POST[i]
        job_id = exploit.execute(payload=request.POST['payload'])
        return render(request,'job_id.html',{'job_id':job_id,'client':client.sessions.list})
